openapi: 3.0.0
info:
  title: ScalarTax
  description : Transaction Rules Rules API Documentation
  version: 1.0.0
  contact:
    name: API Support
    url: http://example.com/supportt
    email: support@example.com
  termsOfService: http://example.com/terms/
servers:
  - url: http://localhost:3001/scalarhubio
    description: Local server
paths:  
  /scalartax/transaction_rules/:
    post:
      tags:
        - Transaction Rules
      summary: Create Transaction Rule
      description: This endpoint allows you to add a new Transaction Rule.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionRule"
              example:
                transaction_rule:
                  name: string
                  entity_id: string
                  effective_date: date
                  expiration_date: date
                  rule_type: string
                  allocate_tax_on_single_line: boolean
                  ignore_rule_on_error: boolean
                  inactive: boolean
                  document_types: array of strings
                operations:
                  - conditions:
                      - field: string
                        operator: string
                        values: null or array
                        address_types: null or array
                      - field: string
                        operator: string
                        values: null or array
                        address_types: null or array
                    allocations:
                      - tax_code: string
                        percentage: number
                        location_id: null or string
                        address_id: string or null
                      - tax_code: string
                        percentage: number
                        location_id: null or string
                        address_id: null or string
        description: Transaction Rule Object
        required: true               
      responses:
        '201':
          description: Transaction Rule Created successfully . 
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionRule"
                example:
                  success: boolean
                  transaction_rule:
                    id: string
                    name: string
                    effective_date: date
                    expiration_date: date
                    rule_type: string
                    document_types: array of strings
                    ignore_rule_on_error: boolean
                    inactive: boolean
                    created_by_id: string
                    updated_by_id: string
                    created_at: datetime
                    updated_at: datetime
                    entity_id: string
                    allocate_tax_on_single_line: boolean
                  operations:
                    - conditions:
                        - id: string
                          transaction_rule_id: string
                          field: string
                          operator: string
                          values: null or array
                          created_at: datetime
                          updated_at: datetime
                          address_types: null or array
                        - id: string
                          transaction_rule_id: string
                          field: string
                          operator: string
                          values: null or array
                          created_at: datetime
                          updated_at: datetime
                          address_types: null or array
                      allocations:
                        - id: string
                          transaction_rule_id: string
                          tax_code: string
                          percentage: number
                          created_at: datetime
                          updated_at: datetime
                          location_id: null or string
                          address_id: string or null
                        - id: string
                          transaction_rule_id: string
                          tax_code: string
                          percentage: number
                          created_at: datetime
                          updated_at: datetime
                          location_id: null or string
                          address_id: null or string           
        '422':
          description:  Unprocessable Entity. Validation errors occurred during the creation.
          content:
            application/json:
              schema:
                type: object
                example:
                  errors: [ Failed to Create Transaction Rule ]
        '400':
          description: Bad Request
        '500':
          description: Internal Server Error.
    get:
      tags:
        - Transaction Rules
      summary: List Transaction Rules
      description: This endpoint retrieves the details of all Transaction Rules.
      responses:
        '200':
          description: OK   
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionRule"
                example:
                  - success: boolean
                    transaction_rule:
                      id: string
                      name: string
                      effective_date: date
                      expiration_date: date
                      rule_type: string
                      document_types: array of strings
                      ignore_rule_on_error: boolean
                      inactive: boolean
                      created_by_id: string
                      updated_by_id: string
                      created_at: datetime
                      updated_at: datetime
                      entity_id: string
                      allocate_tax_on_single_line: boolean
                    operations:
                      - conditions:
                          - id: string
                            transaction_rule_id: string
                            field: string
                            operator: string
                            values: null or array
                            created_at: datetime
                            updated_at: datetime
                            address_types: null or array
                          - id: string
                            transaction_rule_id: string
                            field: string
                            operator: string
                            values: null or array
                            created_at: datetime
                            updated_at: datetime
                            address_types: null or array
                        allocations:
                          - id: string
                            transaction_rule_id: string
                            tax_code: string
                            percentage: number
                            created_at: datetime
                            updated_at: datetime
                            location_id: null or string
                            address_id: string or null
                          - id: string
                            transaction_rule_id: string
                            tax_code: string
                            percentage: number
                            created_at: datetime
                            updated_at: datetime
                            location_id: null or string
                            address_id: null or string
        '400':
          description: Bad Request
        '500':
          description: Internal Server Error
  /scalartax/transaction_rules/{id}:
    get:
      tags:
        - Transaction Rule
      summary: Fetch Transaction Rule
      description: The response will include the following details of the Transaction Rule.
      parameters:
        - name: id
          in: path
          schema:
            type: string
          required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionRule"
                example:
                  success: boolean
                  transaction_rule:
                    id: string
                    name: string
                    effective_date: date
                    expiration_date: date
                    rule_type: string
                    document_types: array of strings
                    ignore_rule_on_error: boolean
                    inactive: boolean
                    created_by_id: string
                    updated_by_id: string
                    created_at: datetime
                    updated_at: datetime
                    entity_id: string
                    allocate_tax_on_single_line: boolean
                  operations:
                    - conditions:
                        - id: string
                          transaction_rule_id: string
                          field: string
                          operator: string
                          values: null or array
                          created_at: datetime
                          updated_at: datetime
                          address_types: null or array
                        - id: string
                          transaction_rule_id: string
                          field: string
                          operator: string
                          values: null or array
                          created_at: datetime
                          updated_at: datetime
                          address_types: null or array
                      allocations:
                        - id: string
                          transaction_rule_id: string
                          tax_code: string
                          percentage: number
                          created_at: datetime
                          updated_at: datetime
                          location_id: null or string
                          address_id: string or null
                        - id: string
                          transaction_rule_id: string
                          tax_code: string
                          percentage: number
                          created_at: datetime
                          updated_at: datetime
                          location_id: null or string
                          address_id: null or string              
        '404':
          description: Not Found.Transaction Rule with that Specific ID not Found.
          content:
            application/json:
              schema:
                type: object
                example:
                  error: Transaction Rule Not Found.
        '500':
          description: Internal Serval Error.
    put:
      tags:
        - Transaction Rule
      summary: Update Transaction Rule
      description: This API endpoint is used to update the details of a specific Transaction Rule for a tenant.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionRule"
              example:
                transaction_rule:
                  name: string
                  entity_id: string
                  effective_date: date
                  expiration_date: date
                  rule_type: string
                  allocate_tax_on_single_line: boolean
                  ignore_rule_on_error: boolean
                  inactive: boolean
                  document_types: array of strings
                operations:
                  - conditions:
                      - field: string
                        operator: string
                        values: null or array
                        address_types: null or array
                      - field: string
                        operator: string
                        values: null or array
                        address_types: null or array
                    allocations:
                      - tax_code: string
                        percentage: number
                        location_id: null or string
                        address_id: string or null
                      - tax_code: string
                        percentage: number
                        location_id: null or string
                        address_id: null or string
        description: Transaction Rule object
        required: true 
      parameters:
        - name: id
          in: path
          schema:
            type: string
          required: true
      responses:
        '200':
          description: OK.Transaction Rule Updated Successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionRule"
                example:
                  success: boolean
                  transaction_rule:
                    id: string
                    name: string
                    effective_date: date
                    expiration_date: date
                    rule_type: string
                    document_types: array of strings
                    ignore_rule_on_error: boolean
                    inactive: boolean
                    created_by_id: string
                    updated_by_id: string
                    created_at: datetime
                    updated_at: datetime
                    entity_id: string
                    allocate_tax_on_single_line: boolean
                  operations:
                    - conditions:
                        - id: string
                          transaction_rule_id: string
                          field: string
                          operator: string
                          values: null or array
                          created_at: datetime
                          updated_at: datetime
                          address_types: null or array
                        - id: string
                          transaction_rule_id: string
                          field: string
                          operator: string
                          values: null or array
                          created_at: datetime
                          updated_at: datetime
                          address_types: null or array
                      allocations:
                        - id: string
                          transaction_rule_id: string
                          tax_code: string
                          percentage: number
                          created_at: datetime
                          updated_at: datetime
                          location_id: null or string
                          address_id: string or null
                        - id: string
                          transaction_rule_id: string
                          tax_code: string
                          percentage: number
                          created_at: datetime
                          updated_at: datetime
                          location_id: null or string
                          address_id: null or string
        '400':
          description: Bad Request
        '404':
          description: Not Found.Transaction Rule with that Specific ID not Found.
          content:
            application/json:
              schema:
                type: object
                example:
                  error: Transaction Rule Not Found.
        '422':
          description: Unprocessable Entity. Validation errors occurred during the update.
          content:
            application/json:
              schema:
                type: object
                example:
                  errors: [ Product code can't be blank,Category is invalid ]
        '500':
          description: Internal Server Error
    delete:
      tags:
        - Transaction Rule
      summary: Delete Transaction Rule
      description: This endpoint is used to delete a specific Transaction Rule belonging to a tenant.
      parameters:
        - name: id
          in: path
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Ok. Transaction Rule Deleted successfully  
        '404':
          description: Not Found.Transaction Rule with the Specific ID not Found.
          content:
            application/json:
              schema:
                type: object
                example:
                  error: Failed to delete the Tax Rule
        '500':
          description: Internal Server Error
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    TransactionRule:
      type: object
      properties:
        transaction_rule:
          type: object
          properties:
            name:
              type: string
              description: Name of the transaction rule
            entity_id:
              type: string
              description: Unique identifier for the entity
            effective_date:
              type: string
              format: date
              description: Effective date of the rule
            expiration_date:
              type: string
              format: date
              description: Expiration date of the rule
            rule_type:
              type: string
              description: Type of the rule (e.g., Allocation Rule)
            allocate_tax_on_single_line:
              type: boolean
              description: Flag to indicate if tax is allocated on a single line
            ignore_rule_on_error:
              type: boolean
              description: Flag to indicate if rule should be ignored on error
            inactive:
              type: boolean
              description: Flag to indicate if the rule is inactive
            document_types:
              type: array
              items:
                type: string
              description: List of document types (e.g., invoice, credit memo)          
        operations:
          type: array
          items:
            type: object
            properties:
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    field:
                      type: string
                      description: Field to apply the condition
                    operator:
                      type: string
                      description: Operator for the condition (e.g., equals, greater_than)
                    values:
                      type: object
                      properties:
                        min:
                          type: number
                          description: Minimum value for the condition
                    address_types:
                      type: array
                      items:
                        type: object
                        properties:
                          tax_code:
                            type: string
                            description: Tax code for the address
                          percent_allocated:
                            type: number
                            description: Percent allocated for the tax code
              allocations:
                type: array
                items:
                  type: object
                  properties:
                    tax_code:
                      type: string
                      description: Tax code for the allocation
                    location_id:
                      type: string
                      description: Location identifier (nullable)
                    address_id:
                      type: integer
                      description: Address identifier (nullable)
                    percentage:
                      type: number
                      description: Allocation percentage
                    country:
                      type: string
                      description: Country for the allocation
                    address_line1:
                      type: string
                      description: Address line 1
                    address_line2:
                      type: string
                      description: Address line 2
                    city:
                      type: string
                      description: City for the allocation
                    state:
                      type: string
                      description: State for the allocation
                    zip_code:
                      type: string
                      description: Zip code for the allocation
    TransactionRule1:
      type: object
      properties:
        sucesss: true|false
        transaction_rule:
          type: object
          properties:
            id:
              type: string
              description: Unique identifier for the transaction rule
            name:
              type: string
              description: Name of the transaction rule
            entity_id:
              type: string
              description: Unique identifier for the entity
            effective_date:
              type: string
              format: date
              description: Effective date of the rule
            expiration_date:
              type: string
              format: date
              description: Expiration date of the rule
            rule_type:
              type: string
              description: Type of the rule (e.g., Allocation Rule)
            document_types:
              type: array
              items:
                type: string
              description: List of document types (e.g., invoice, credit memo)    
            ignore_rule_on_error:
              type: boolean
              description: Flag to indicate if rule should be ignored on error
            inactive:
              type: boolean
              description: Flag to indicate if the rule is inactive 
            created_by_id:  
              type: string
              description: Identifier of the user who created the transaction rule
            updated_by_id:
              type: string
              description: Identifier of the user who updated the transaction rule
            created_at:
              type: string
              description: Date and time when the trsaction rule was created
            updated_at:
              type: string
              description: Date and time when the trsaction rule was last updated
            allocate_tax_on_single_line:
              type: boolean
              description: Flag to indicate if tax is allocated on a single line     
        operations:
          type: array
          items:
            type: object
            properties:
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      description: Unique identifier for the codition
                    transaction_rule_id:
                      type: string
                      description: Unique identifier
                    field:
                      type: string
                      description: Field to apply the condition
                    operator:
                      type: string
                      description: Operator for the condition (e.g., equals, greater_than)
                    values:
                      type: object
                      properties:
                        min:
                          type: number
                          description: Minimum value for the condition
                    created_at:
                      type: string
                      description: Date and time when the condition was created
                    updated_at:
                      type: string
                      description: Date and time when the condition was last updated
                    address_types:
                      type: array
                      items:
                        type: object
                        properties:
                          tax_code:
                            type: string
                            description: Tax code for the address
                          percent_allocated:
                            type: number
                            description: Percent allocated for the tax code
              allocations:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      description: Unique identifier for the allocation
                    transaction_rule_id:
                      type: string
                      description: Unique identifier
                    tax_code:
                      type: string
                      description: Tax code for the allocation
                    location_id:
                      type: string
                      description: Location identifier (nullable)
                    address_id:
                      type: integer
                      description: Address identifier (nullable)
                    percentage:
                      type: number
                      description: Allocation percentage
                    created_at:
                      type: string
                      description: Date and time when the allocation was created
                    updated_at:
                      type: string
                      description: Date and time when the allocation was last updated  
      required:
        - transaciton_rule
        - operations          

